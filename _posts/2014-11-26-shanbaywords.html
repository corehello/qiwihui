<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>ShanbayWordsSearch</title>
  <script src="http://code.jquery.com/jquery-1.7.1.min.js" type="text/javascript"></script>
</head>
<body>
 
<form action="https://api.shanbay.com/bdc/search/?word=" id="searchForm">
  <input type="text" name="word" placeholder="Search...">
  <input type="submit" value="Search">
</form>
<!-- the result of the search will be rendered inside this div -->
<div id="result"></div>
 
<script>
	
	function handleWord(word){
		gWord=word;
		if(word&&word["result"]==0){//????
			var w=document.createElement("div"); 
			var c =document.createElement("div");
			var other = document.createElement("div");
			//var i = document.createElement("div");	
			var t = document.createElement("span");
			t.setAttribute("class", "wd");
			t.appendChild(document.createTextNode(word["content"]));
			w.appendChild(t);
			t = document.createElement("span");
			t.setAttribute("class", "prn");
			if(word["pron"]!='')
				t.innerHTML='['+word.pron+'] ';
			w.appendChild(t);
		
			if(word.audio){
				t = document.createElement("img");
				t.setAttribute("src", "/img/SpeakerOffA20.png");
				t.setAttribute("title", "??");
				var t1 =t ;
				t =document.createElement("a");
				t.setAttribute("href", "#");
				t.setAttribute("onclick", "play_single_sound();");
				t.appendChild(t1);
				t1 = t;
				t = document.createElement("span");
				t.appendChild(t1);
				w.appendChild(t);
				var audioElement = document.getElementById('sound');
				audioElement.removeAttribute('src');
				audioElement.setAttribute('src', word.audio);
			}
		
			w.setAttribute("id", "word");
				
			t=document.createElement("span");
			t.innerHTML=word["definition"].replace(/\n/g,"<br />"); //fixme
			t.setAttribute("class","content");
			c.appendChild(t);
			c.setAttribute("class","definition");
			
			t = document.createElement("input");
			t.setAttribute('id','interactive');
			t.setAttribute('type','button');
		
			other.appendChild(document.createElement('br'));
			other.setAttribute('id','other');
			
			result = document.getElementById('result');
			result.innerHTML='';
			result.appendChild(w);
			result.appendChild(c);
			result.appendChild(other);
			
			//result.appendChild(i);
		}else{  
			result = document.getElementById('result');
			word = document.getElementsByName("word")[0].value; //damn
			result.innerHTML='??????<span class="highlight">'+word+'</span> ????<br><br>' ; 
		}
	}
	
	// Create the XHR object.
	function createCORSRequest(method, url) {
		var xhr = new XMLHttpRequest();
		if ("withCredentials" in xhr) {
			// XHR for Chrome/Firefox/Opera/Safari.
			xhr.open(method, url, true);
		} else if (typeof XDomainRequest != "undefined") {
			// XDomainRequest for IE.
			xhr = new XDomainRequest();
			xhr.open(method, url);
		} else {
			// CORS not supported.
			xhr = null;
		}
		return xhr;
	}
	
	$( "#searchForm" ).submit(function( event ) {
		event.preventDefault();
	
		var $form = $( this );
/*
		function loadword( data ) {
			var content = $( data ).find( "#content" );
			$( "#result" ).empty().append( content );
		}
		*/
		// Make the actual CORS request.
		function makeCorsRequest() {
		
			term = $form.find( "input[name='word']" ).val(),
			url = $form.attr( "action" );
			console.log(url);
			
			var xhr = createCORSRequest('GET', url + term);
			if (!xhr) {
				$( "#result" ).empty().append('CORS not supported');
				return;
			}
	
			xhr.onload = function() {
				var text = xhr.responseText;
				var obj= text.parseJSON();
				handleWord(obj);
			};
			
			xhr.onerror = function() {
				$( "#result" ).empty().append( 'Woops, there was an error making the request.' );
			};
			
			xhr.send(null);
		}
		/*
		term = $form.find( "input[name='word']" ).val(),
		url = $form.attr( "action" );
		$.ajax({
			url: "https://api.shanbay.com/bdc/search/?word=",
			data: term,
			success: console.log("success"),
			dataType: "Application/json"
		});
		*/
		makeCorsRequest();
	});

</script>
 
</body>
</html>
